# Starter pipeline

# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- main

pool:
  vmImage: ubuntu-latest

steps:
- task: NodeTool@0
  inputs:
    versionSpec: "16.x"

- task: Npm@1
  displayName: "Install frontend"
  inputs:
      command: "install"
      workingDir: "frontend"    

- task: Npm@1
  displayName: "Bundle frontend"
  inputs:
      command: "custom"
      workingDir: "frontend"
      customCommand: "run-script build"

- task: PublishPipelineArtifact@1
  inputs:
      targetPath: "$(Pipeline.Workspace)/s/frontend/out/bmt.zip"
      artifactName: DCD

- task: FusionCLI@2
  inputs:
    azureSubscription: 'dcd-pipeline-sp'
    appFolder: 'frontend'
    command: 'build-app'